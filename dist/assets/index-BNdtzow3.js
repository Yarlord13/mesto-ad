(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const R=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,onInfoButton:n},c,i)=>{const l=getTemplate(),v=l.querySelector(".card__like-button"),B=l.querySelector(".card__control-button_type_delete"),j=l.querySelector(".card__control-button_type_info"),b=l.querySelector(".card__image"),J=l.querySelector(".card__title"),T=l.querySelector(".card__like-count");return b.src=e.link,b.alt=e.name,J.textContent=e.name,T&&(T.textContent=e.likesCount||0),e.isLiked&&v.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==c&&(B.style.display="none"),o&&v.addEventListener("click",()=>o(v,i)),r&&e.owner&&e.owner._id===c&&B.addEventListener("click",()=>r(l,i)),t&&b.addEventListener("click",()=>t({name:e.name,link:e.link})),n&&j.addEventListener("click",()=>n(i)),l},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},K=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},F=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},G=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?F(e,t,o):K(e,t,t.validationMessage,o)},Q=e=>Array.from(e).some(t=>!t.validity.valid),N=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},X=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},P=(e,t,o)=>{Q(e)?N(t,o):X(t,o)},Y=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);P(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{G(e,n,t),P(o,r,t)})})},f=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{F(e,n,t)}),N(r,t)},Z=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{Y(o,e)})},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"435a7b59-8fdf-4fcc-b21d-53bc775e9c19","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u),O=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(u),te=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(u),oe=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(u),re=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(u),ne=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u),ce=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(u),_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Z(_);const D=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),S=L.querySelector(".popup__form"),W=S.querySelector(".popup__input_type_name"),V=S.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),a=g.querySelector(".popup__form"),se=a.querySelector(".popup__input_type_card-name"),le=a.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_image"),U=k.querySelector(".popup__image"),ie=k.querySelector(".popup__caption"),ae=document.querySelector(".profile__edit-button"),ue=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),d=w.querySelector(".popup__form"),pe=d.querySelector(".popup__input");let q="";const H=(e,t)=>{const o=e.likes.some(n=>n._id===t),r=R({...e,isLiked:o,likesCount:e.likes.length},{onPreviewPicture:de,onLikeIcon:(n,c)=>_e(n,c),onDeleteCard:(n,c)=>me(n,c),onInfoButton:qe},t,e._id);if(e.owner._id===t){const n=r.querySelector(".card__control-button_type_delete");n.style.display="block"}return r},de=({name:e,link:t})=>{U.src=t,U.alt=e,ie.textContent=e,m(k)},_e=(e,t,o)=>{const r=e.classList.contains("card__like-button_is-active"),n=e.closest(".card__likes").querySelector(".card__like-count");ce(t,r).then(c=>{e.classList.toggle("card__like-button_is-active"),n.textContent=c.likes.length}).catch(c=>{console.log(c)})},me=(e,t)=>{ne(t).then(()=>{e.remove()}).catch(o=>{console.log(o)})},fe=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",te({name:W.value,about:V.value}).then(r=>{E.textContent=r.name,x.textContent=r.about,p(L)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})},ye=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",oe(pe.value).then(r=>{I.style.backgroundImage=`url(${r.avatar})`,d.reset(),p(w),f(d,_)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})},he=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",re({name:se.value,link:le.value}).then(r=>{const n=H(r,q);D.prepend(n),a.reset(),p(g),f(a,_)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})};S.addEventListener("submit",fe);a.addEventListener("submit",he);d.addEventListener("submit",ye);ae.addEventListener("click",()=>{W.value=E.textContent,V.value=x.textContent,f(S,_),m(L)});I.addEventListener("click",()=>{d.reset(),f(d,_),m(w)});ue.addEventListener("click",()=>{a.reset(),f(a,_),m(g)});Promise.all([O(),ee()]).then(([e,t])=>{q=t._id,E.textContent=t.name,x.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{const r=H(o,q);D.append(r)})}).catch(e=>{console.log(e)});const Se=document.querySelectorAll(".popup");Se.forEach(e=>{z(e)});const y=document.querySelector(".popup_type_info"),ve=y.querySelector(".popup__title"),h=y.querySelector(".popup__info"),A=y.querySelector(".popup__text"),M=y.querySelector(".popup__list"),be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),C=(e,t)=>{const r=document.querySelector("#popup-info-definition-template").content.cloneNode(!0),n=r.querySelector(".popup__info-term"),c=r.querySelector(".popup__info-description");return n.textContent=e,c.textContent=t,r},Ce=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0),r=o.querySelector(".popup__list-item_type_badge");return r.textContent=e.name,o},qe=e=>{h.innerHTML="",M.innerHTML="",O().then(t=>{const o=t.find(r=>r._id===e);if(!o){console.error("Карточка не найдена");return}ve.textContent=o.name,h.append(C("Дата создания:",be(new Date(o.createdAt)))),h.append(C("Количество лайков:",o.likes.length.toString())),h.append(C("Автор:",o.owner.name||"Неизвестно")),o.likes.length>0?(A.textContent="Пользователи, лайкнувшие карточку:",o.likes.forEach(r=>{M.append(Ce(r))})):A.textContent="Эту карточку еще никто не лайкнул",m(y)}).catch(t=>{console.log(t)})};
