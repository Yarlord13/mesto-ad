(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const O=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r,c)=>{const l=O(),f=l.querySelector(".card__like-button"),E=l.querySelector(".card__control-button_type_delete"),h=l.querySelector(".card__image"),M=l.querySelector(".card__title"),x=l.querySelector(".card__like-count");return h.src=e.link,h.alt=e.name,M.textContent=e.name,x&&(x.textContent=e.likesCount||0),e.isLiked&&f.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==r&&(E.style.display="none"),o&&f.addEventListener("click",()=>o(f,c)),n&&e.owner&&e.owner._id===r&&E.addEventListener("click",()=>n(l,c)),t&&h.addEventListener("click",()=>t({name:e.name,link:e.link})),l},w=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",w)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",w)},V=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},W=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},A=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},j=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?A(e,t,o):W(e,t,t.validationMessage,o)},J=e=>Array.from(e).some(t=>!t.validity.valid),I=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},D=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},B=(e,t,o)=>{J(e)?I(t,o):D(t,o)},H=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);B(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{j(e,r,t),B(o,n,t)})})},_=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{A(e,r,t)}),I(n,t)},z=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{H(o,e)})},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"435a7b59-8fdf-4fcc-b21d-53bc775e9c19","Content-Type":"application/json"}},a=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),K=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(a),R=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(a),G=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(a),Q=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(a),X=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(a),Y=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(a),Z=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(a),p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};z(p);const T=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),y=v.querySelector(".popup__form"),$=y.querySelector(".popup__input_type_name"),U=y.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),i=b.querySelector(".popup__form"),ee=i.querySelector(".popup__input_type_card-name"),te=i.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),P=C.querySelector(".popup__image"),oe=C.querySelector(".popup__caption"),re=document.querySelector(".profile__edit-button"),ne=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),d=k.querySelector(".popup__form"),ce=d.querySelector(".popup__input");let S="";const F=(e,t)=>{const o=e.likes.some(r=>r._id===t),n=N({...e,isLiked:o,likesCount:e.likes.length},{onPreviewPicture:se,onLikeIcon:(r,c)=>le(r,c),onDeleteCard:(r,c)=>ie(r,c)},t,e._id);if(e.owner._id===t){const r=n.querySelector(".card__control-button_type_delete");r.style.display="block"}return n},se=({name:e,link:t})=>{P.src=t,P.alt=e,oe.textContent=e,m(C)},le=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active"),r=e.closest(".card__likes").querySelector(".card__like-count");Z(t,n).then(c=>{e.classList.toggle("card__like-button_is-active"),r.textContent=c.likes.length}).catch(c=>{console.log(c)})},ie=(e,t)=>{Y(t).then(()=>{e.remove()}).catch(o=>{console.log(o)})},ae=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",G({name:$.value,about:U.value}).then(n=>{L.textContent=n.name,q.textContent=n.about,u(v)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},ue=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",Q(ce.value).then(n=>{g.style.backgroundImage=`url(${n.avatar})`,d.reset(),u(k),_(d,p)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},de=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",X({name:ee.value,link:te.value}).then(n=>{const r=F(n,S);T.prepend(r),i.reset(),u(b),_(i,p)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})};y.addEventListener("submit",ae);i.addEventListener("submit",de);d.addEventListener("submit",ue);re.addEventListener("click",()=>{$.value=L.textContent,U.value=q.textContent,_(y,p),m(v)});g.addEventListener("click",()=>{d.reset(),_(d,p),m(k)});ne.addEventListener("click",()=>{i.reset(),_(i,p),m(b)});Promise.all([R(),K()]).then(([e,t])=>{S=t._id,L.textContent=t.name,q.textContent=t.about,g.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{const n=F(o,S);T.append(n)})}).catch(e=>{console.log(e)});const pe=document.querySelectorAll(".popup");pe.forEach(e=>{V(e)});
